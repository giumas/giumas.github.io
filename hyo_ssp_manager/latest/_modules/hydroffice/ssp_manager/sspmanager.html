<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hydroffice.ssp_manager.sspmanager &mdash; HydrOffice SSP Manager 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/hyo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="HydrOffice SSP Manager 2.1.0 documentation" href="../../../index.html" />
    <link rel="up" title="hydroffice.ssp_manager" href="../ssp_manager.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydrOffice SSP Manager 2.1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../ssp_manager.html" accesskey="U">hydroffice.ssp_manager</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<div class="deck">

    <p>
    This document describes the HydrOffice SSP Manager (2.1). For the source code,
    <a href="https://bitbucket.org/ccomjhc/hyo_ssp_manager">go here</a>.
    </p>

</div>
    <h1>Source code for hydroffice.ssp_manager.sspmanager</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">from</span> <span class="nn">wx</span> <span class="kn">import</span> <span class="n">PyDeadObjectError</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">wxmpl</span>  <span class="c"># local version of this module, since Pydro&#39;s one has an issue</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">hydroffice.base.helper</span> <span class="kn">import</span> <span class="n">HyOError</span>
<span class="kn">from</span> <span class="nn">hydroffice.base.timerthread</span> <span class="kn">import</span> <span class="n">TimerThread</span>
<span class="kn">from</span> <span class="nn">hydroffice.base.gdal_aux</span> <span class="kn">import</span> <span class="n">GdalAux</span>
<span class="kn">from</span> <span class="nn">.plots</span> <span class="kn">import</span> <span class="n">WxPlots</span><span class="p">,</span> <span class="n">PlotsSettings</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">sspmanager_ui</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">refmonitor</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geomonitor</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">settingsviewer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">userinputsviewer</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__license__</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp</span> <span class="kn">import</span> <span class="n">project</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp</span> <span class="kn">import</span> <span class="n">oceanography</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp.ssp_db</span> <span class="kn">import</span> <span class="n">SspDb</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp.ssp_dicts</span> <span class="kn">import</span> <span class="n">Dicts</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp.ssp_collection</span> <span class="kn">import</span> <span class="n">SspCollection</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp.helper</span> <span class="kn">import</span> <span class="n">Helper</span><span class="p">,</span> <span class="n">SspError</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp.atlases.woa09checker</span> <span class="kn">import</span> <span class="n">Woa09Checker</span>
<span class="kn">from</span> <span class="nn">hydroffice.ssp_settings</span> <span class="kn">import</span> <span class="n">ssp_settings</span>


<div class="viewcode-block" id="SSPManager"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager">[docs]</a><span class="k">class</span> <span class="nc">SSPManager</span><span class="p">(</span><span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">SSPManagerBase</span><span class="p">):</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

    <span class="n">gui_state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;OPEN&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;CLOSED&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;SERVER&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">SSPManagerBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">__license__</span>

        <span class="c"># take care of WOA09 atlas</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Woa09Checker</span><span class="o">.</span><span class="n">is_present</span><span class="p">():</span>
            <span class="n">dial</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;The WOA09 atlas (used by some advanced SSP functions)</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;was not found!</span><span class="se">\n\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;The required data files (~350MB) can be retrieved by</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;downloading this archive:</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;   ftp.ccom.unh.edu/fromccom/hydroffice/woa09.zip</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;and unzipping it into:</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;   </span><span class="si">%s</span><span class="se">\n\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;Do you want that I perform this operation for you?</span><span class="se">\n</span><span class="s">&#39;</span>
                                          <span class="s">&#39;Internet connection is required!</span><span class="se">\n</span><span class="s">&#39;</span>
                                    <span class="o">%</span> <span class="n">Woa09Checker</span><span class="o">.</span><span class="n">get_atlases_folder</span><span class="p">(),</span>
                                    <span class="s">&#39;SSP Manager - WOA09 atlas&#39;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES_DEFAULT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dial</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
                <span class="n">chk</span> <span class="o">=</span> <span class="n">Woa09Checker</span><span class="p">()</span>
                <span class="n">with_woa09</span> <span class="o">=</span> <span class="n">chk</span><span class="o">.</span><span class="n">present</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">with_woa09</span><span class="p">:</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Unable to retrieve the WOA09 atlas. You might:</span><span class="se">\n</span><span class="s">&#39;</span>
                                           <span class="s">&#39; - download the archive from (anonymous ftp):</span><span class="se">\n</span><span class="s">&#39;</span>
                                           <span class="s">&#39;   ftp.ccom.unh.edu/fromccom/hydroffice/woa09.zip</span><span class="se">\n</span><span class="s">&#39;</span>
                                           <span class="s">&#39; - unzip the archive into:</span><span class="se">\n</span><span class="s">&#39;</span>
                                           <span class="s">&#39;   </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span>
                                           <span class="s">&#39; - restart SSP Manager</span><span class="se">\n</span><span class="s">&#39;</span>
                                     <span class="o">%</span> <span class="n">Woa09Checker</span><span class="o">.</span><span class="n">get_atlases_folder</span><span class="p">(),</span>
                                     <span class="s">&#39;WOA09 atlas&#39;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;disabling WOA09 functions&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;disabling WOA09 functions&quot;</span><span class="p">)</span>
                <span class="n">with_woa09</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">with_woa09</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">with_rtofs</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># We load WOA09 atlas and attempt the RTOFS atlas (since it requires internet connection)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="n">with_listeners</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_woa09</span><span class="o">=</span><span class="n">with_woa09</span><span class="p">,</span> <span class="n">with_rtofs</span><span class="o">=</span><span class="n">with_rtofs</span><span class="p">)</span>

        <span class="c"># check listeners</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_running_listeners</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Kongsberg and/or Sippican and/or MVP network I/O cannot bind to ports.</span><span class="se">\n</span><span class="s">&#39;</span> \
                  <span class="s">&#39;Is there another instance of SSP Manager running already?&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="c"># check woa09 atlas</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">)</span> <span class="ow">and</span> <span class="n">with_woa09</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Unable to load World Ocean Atlas grid file&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="c"># check rtofs atlas</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas_loaded</span><span class="p">)</span> <span class="ow">and</span> <span class="n">with_rtofs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Unable to load RTOFS atlas.</span><span class="se">\n</span><span class="s">&#39;</span> \
                  <span class="s">&#39;To use RTOFS, Internet connectivity is required (with port 9090 open).</span><span class="se">\n</span><span class="s">&#39;</span> \
                  <span class="s">&#39;RTOFS queries disabled.&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Warning&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_WARNING</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="c"># UI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">PlotsSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_viewer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_tool</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs_viewer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_ui</span><span class="p">()</span>

        <span class="c"># update state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;CLOSED&quot;</span><span class="p">])</span>

        <span class="c"># GUI timers (status bar and plots)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_timer</span> <span class="o">=</span> <span class="n">TimerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_timer</span> <span class="o">=</span> <span class="n">TimerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">550</span><span class="p">))</span>

<div class="viewcode-block" id="SSPManager.init_ui"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.init_ui">[docs]</a>    <span class="k">def</span> <span class="nf">init_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">favicon</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;media&#39;</span><span class="p">,</span> <span class="s">&#39;favicon.png&#39;</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_PNG</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">SetIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">favicon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&#39;nt&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># This is needed to display the app icon on the taskbar on Windows 7</span>
                <span class="kn">import</span> <span class="nn">ctypes</span>
                <span class="n">app_id</span> <span class="o">=</span> <span class="s">&#39;SSP Manager v.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">shell32</span><span class="o">.</span><span class="n">SetCurrentProcessExplicitAppUserModelID</span><span class="p">(</span><span class="n">app_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Unable to change app icon: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_file_exit</span><span class="p">)</span>

        <span class="c"># add plots panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span> <span class="o">=</span> <span class="n">WxPlots</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">callback_right_click_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_context</span>

        <span class="c"># expand the panel to fit the whole app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetSizer</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetSizer</span><span class="p">()</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

        <span class="c"># register to receive wxPython SelectionEvents from a PlotPanel or PlotFrame</span>
        <span class="n">wxmpl</span><span class="o">.</span><span class="n">EVT_SELECTION</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_area_selected</span><span class="p">)</span>
        <span class="n">wxmpl</span><span class="o">.</span><span class="n">EVT_POINT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_point_selected</span><span class="p">)</span>

        <span class="c"># Other graphical panels are instantiated and are only shown when requested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span> <span class="o">=</span> <span class="n">refmonitor</span><span class="o">.</span><span class="n">RefMonitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span> <span class="o">=</span> <span class="n">geomonitor</span><span class="o">.</span><span class="n">GeoMonitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_viewer</span> <span class="o">=</span> <span class="n">settingsviewer</span><span class="o">.</span><span class="n">SettingsViewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs_viewer</span> <span class="o">=</span> <span class="n">userinputsviewer</span><span class="o">.</span><span class="n">UserInputsViewer</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">ssp_user_inputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_context"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_context">[docs]</a>    <span class="k">def</span> <span class="nf">on_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create and show a Context Menu &quot;&quot;&quot;</span>
        <span class="c"># we don&#39;t want the context menu without data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">id_ctx_reset_view</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">id_ctx_zoom</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">id_ctx_flag</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">id_ctx_unflag</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">id_ctx_insert</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># only do this part the first time so the events are only bound once</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;id_ctx_reset_view&quot;</span><span class="p">):</span>
            <span class="n">id_ctx_reset_view</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_reset_view</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_ctx_reset_view</span><span class="p">)</span>
            <span class="n">id_ctx_zoom</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_popup</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_ctx_zoom</span><span class="p">)</span>
            <span class="n">id_ctx_flag</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_popup</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_ctx_flag</span><span class="p">)</span>
            <span class="n">id_ctx_unflag</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_popup</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_ctx_unflag</span><span class="p">)</span>
            <span class="n">id_ctx_insert</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_popup</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">id_ctx_insert</span><span class="p">)</span>

        <span class="c"># build the menu</span>
        <span class="n">context_menu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">context_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">id_ctx_reset_view</span><span class="p">,</span> <span class="s">&quot;Reset view&quot;</span><span class="p">)</span>
        <span class="n">context_menu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>
        <span class="n">item_zoom</span> <span class="o">=</span> <span class="n">context_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">id_ctx_zoom</span><span class="p">,</span> <span class="s">&quot;Zoom&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;Zoom on plot by mouse selection&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ITEM_RADIO</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotZoom</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">():</span>
            <span class="n">item_zoom</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">item_flag</span> <span class="o">=</span> <span class="n">context_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">id_ctx_flag</span><span class="p">,</span> <span class="s">&quot;Flag&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;Flag samples on plot by mouse selection&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ITEM_RADIO</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotFlag</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">():</span>
            <span class="n">item_flag</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">item_unflag</span> <span class="o">=</span> <span class="n">context_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">id_ctx_unflag</span><span class="p">,</span> <span class="s">&quot;Unflag&quot;</span><span class="p">,</span>
                                          <span class="s">&quot;Unflag samples on plot by mouse selection&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ITEM_RADIO</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotUnflag</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">():</span>
            <span class="n">item_unflag</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">item_insert</span> <span class="o">=</span> <span class="n">context_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">id_ctx_insert</span><span class="p">,</span> <span class="s">&quot;Insert&quot;</span><span class="p">,</span>
                                          <span class="s">&quot;Insert a sample by mouse clicking&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ITEM_RADIO</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotInsert</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">():</span>
            <span class="n">item_insert</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># show the popup menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopupMenu</span><span class="p">(</span><span class="n">context_menu</span><span class="p">)</span>
        <span class="n">context_menu</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_popup"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_popup">[docs]</a>    <span class="k">def</span> <span class="nf">on_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the label of the menu item selected&quot;&quot;&quot;</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="n">menu_item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">menu_item</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Zoom&quot;</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">wxEVT_COMMAND_MENU_SELECTED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotZoom</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessInspection</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotZoom</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">menu_item</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Flag&quot;</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">wxEVT_COMMAND_MENU_SELECTED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotFlag</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessInspection</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotFlag</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">menu_item</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Unflag&quot;</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">wxEVT_COMMAND_MENU_SELECTED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotUnflag</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessInspection</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotUnflag</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">menu_item</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Insert&quot;</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuEvent</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">wxEVT_COMMAND_MENU_SELECTED</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PlotInsert</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessInspection</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotInsert</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># ####### FILE ########</span>

    <span class="c"># Import</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_castaway"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_castaway">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_castaway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;CASTAWAY&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_saiv"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_saiv">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_saiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;SAIV&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_idronaut"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_idronaut">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_idronaut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;IDRONAUT&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_digibar_pro"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_digibar_pro">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_digibar_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;DIGIBAR_PRO&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_digibar_s"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_digibar_s">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_digibar_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;DIGIBAR_S&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_sippican"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_sippican">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_sippican</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;SIPPICAN&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_seabird"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_seabird">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_seabird</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;SEABIRD&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_turo"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_turo">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_turo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;TURO&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_unb"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_unb">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_unb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;UNB&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_valeport_midas"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_valeport_midas">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_valeport_midas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;VALEPORT_MIDAS&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_valeport_monitor"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_valeport_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_valeport_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;VALEPORT_MONITOR&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_import_valeport_minisvp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_import_valeport_minisvp">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_import_valeport_minisvp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_data_file</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="p">[</span><span class="s">&#39;VALEPORT_MINI_SVP&#39;</span><span class="p">])</span>
</div>
    <span class="k">def</span> <span class="nf">_open_data_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_format</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">input_format</span> <span class="ow">in</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;unsupported import format: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">input_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">import_extensions</span><span class="p">[</span><span class="n">input_format</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;unsupported import extension format: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">input_format</span><span class="p">)</span>

        <span class="c"># retrieve the name of the format</span>
        <span class="n">name_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">import_formats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">input_format</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">selection_filter</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> files (*.</span><span class="si">%s</span><span class="s">,*.</span><span class="si">%s</span><span class="s">)|*.</span><span class="si">%s</span><span class="s">;*.</span><span class="si">%s</span><span class="s">|All File (*.*)|*.*&quot;</span> \
                           <span class="o">%</span> <span class="p">(</span><span class="n">name_format</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">ext</span><span class="p">,</span> <span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;File selection&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">selection_filter</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_CHANGE_DIR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">import_directory</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
        <span class="n">import_file</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">import_directory</span><span class="p">,</span> <span class="n">import_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">open_file_format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">input_format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_position</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SspError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c"># set the new SSP for the refraction monitor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_corrector</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Loaded </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span>

    <span class="c"># Query</span>

<div class="viewcode-block" id="SSPManager.on_file_query_woa09"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_query_woa09">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_query_woa09</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on WOA2009 grid load&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;User requested WOA09 synthetic cast&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">latitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">longitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;not a valid position&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using position: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">))</span>

        <span class="n">query_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_date</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">query_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;not a valid date time&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using date time: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">query_date</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">woa_data</span><span class="p">,</span> <span class="n">woa_min</span><span class="p">,</span> <span class="n">woa_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">query_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">woa_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;unable to retrieve data&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">except</span> <span class="n">SspError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Failed on WOA09 lookup&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;got WOA SSP:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">woa_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="o">=</span> <span class="n">woa_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span> <span class="o">=</span> <span class="n">woa_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="o">=</span> <span class="n">woa_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">woa_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_WOA09&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">_%H%M%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Synthetic WOA09 cast&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Synthetic WOA09 cast using pos: (</span><span class="si">%.6f</span><span class="s">, </span><span class="si">%.6f</span><span class="s">) and time: </span><span class="si">%s</span><span class="s">&quot;</span>
                 <span class="o">%</span> <span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">query_date</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_query_rtofs"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_query_rtofs">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_query_rtofs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas_loaded</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on RTOFS grid load&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;User requested RTOFS synthetic cast&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">latitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">longitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;not a valid position&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using position: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">))</span>

        <span class="n">query_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_date</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">query_date</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;not a valid date time&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using date time: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">query_date</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp_ssp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">query_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp_ssp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;empty result from RTOFS query&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">except</span> <span class="n">SspError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Failed on RTOFS lookup&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span> <span class="o">=</span> <span class="n">temp_ssp</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span>
                                                                                                      <span class="n">longitude</span><span class="p">,</span>
                                                                                                      <span class="n">query_date</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;failure in performing WOA09 lookup&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">HyOError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;failure in performing WOA09 lookup&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_RTOFS&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">_%H%M%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Synthetic RTOFS cast&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Synthetic RTOFS cast using pos: (</span><span class="si">%.6f</span><span class="s">, </span><span class="si">%.6f</span><span class="s">) and time: </span><span class="si">%s</span><span class="s">&quot;</span>
                 <span class="o">%</span> <span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">query_date</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_query_sis"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_query_sis">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_query_sis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;requesting profile from SIS&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="c"># Need to request the current SVP cast from the clients prior.  Take the first one that comes through.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">num_clients</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;testing client </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_recipient_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">get_cast_from_sis</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Unable to get SIS cast from any clients&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Acknowledge&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;got SSP from SIS: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">)</span>

        <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">latitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">longitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;not a valid position&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using position: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">convert_ssp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_SIS&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">_%H%M%S&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Retrieved SIS current cast, user chose </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> for position, cast date is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>

    <span class="c"># Export</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_asvp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_asvp">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_asvp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;ASVP&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_csv"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_csv">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;CSV&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_pro"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_pro">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_pro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;PRO&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_elac"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_elac">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_elac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;ELAC&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_hips"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_hips">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_hips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;HIPS&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_ixblue"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_ixblue">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_ixblue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;IXBLUE&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_unb"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_unb">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_unb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;UNB&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_vel"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_vel">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">switch_export_format</span><span class="p">(</span><span class="s">&quot;VEL&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_export_cast"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_export_cast">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_export_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Manage the user export&quot;&quot;&quot;</span>

        <span class="c"># check if at least a format was selected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">count_export_formats</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Please select at least a file format for export!&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Cast export&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c"># set the export folder and filename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">user_export_prompt_filename</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Specify an output file prefix&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;All Files (*.*)|*.*&quot;</span><span class="p">,</span>
                                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_CHANGE_DIR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_export_directory</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Accommodate files that are imported from an existing file (and have a fully qualified path name</span>
            <span class="c"># in the self.prj.filename variable AND accommodate files that are generated in memory (e.g. WOA query)</span>
            <span class="c"># and have a pathless filename in self.prj.filename.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_export_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">get_output_folder</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># actually do the export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">formats_export</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>

        <span class="c"># open export folder</span>
        <span class="n">Helper</span><span class="o">.</span><span class="n">explore_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_export_directory</span><span class="p">)</span>

    <span class="c"># clear</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_clear"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_clear">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;You haven&#39;t processed/delivered &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> \
                  <span class="o">+</span> <span class="s">&quot; yet!</span><span class="se">\n</span><span class="s">Are you sure you want to close this file?&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Confirm File Close&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.clear_app"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.clear_app">[docs]</a>    <span class="k">def</span> <span class="nf">clear_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;CLOSED&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="SSPManager.on_file_exit"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_file_exit">[docs]</a>    <span class="k">def</span> <span class="nf">on_file_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Do you really want to close this application?&quot;</span><span class="p">,</span> <span class="s">&quot;Confirm Exit&quot;</span><span class="p">,</span>
                               <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Kill all gui tools</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;killing refraction monitor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">OnExit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;killing geo monitor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span><span class="o">.</span><span class="n">OnExit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs_viewer</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;killing user inputs viewer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs_viewer</span><span class="o">.</span><span class="n">OnExit</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_viewer</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;killing settings viewer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings_viewer</span><span class="o">.</span><span class="n">OnExit</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_timer</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;stopping status timer&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_timer</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_timer</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;stopping plot timer&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_timer</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># to be sure that all the threads stop</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>  <span class="c"># Close the frame.</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;exit done&quot;</span><span class="p">)</span>

    <span class="c"># ####### View ########</span>
</div>
<div class="viewcode-block" id="SSPManager.on_reset_view"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_reset_view">[docs]</a>    <span class="k">def</span> <span class="nf">on_reset_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">has_zoom_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_view_hide_flagged"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_view_hide_flagged">[docs]</a>    <span class="k">def</span> <span class="nf">on_view_hide_flagged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_flagged</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_flagged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_view_hide_woa"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_view_hide_woa">[docs]</a>    <span class="k">def</span> <span class="nf">on_view_hide_woa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_woa</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_woa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_view_hide_depth"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_view_hide_depth">[docs]</a>    <span class="k">def</span> <span class="nf">on_view_hide_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_depth</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_reset_view_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">has_zoom_applied</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">good_pts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_flagged</span><span class="p">:</span>
            <span class="n">good_pts</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_woa</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                                   <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                                   <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span>
                                   <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span>
                                   <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span>
                                  <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span>
                                  <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span>
                                 <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span>
                                 <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                                           <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                                           <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span>
                                           <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span>
                                           <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span>
                                          <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span>
                                              <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span>
                                          <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span>
                                              <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span>
                                         <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span>
                                         <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                                           <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                                           <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span>
                                           <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span>
                                           <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span>
                                          <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span>
                                              <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span>
                                          <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span>
                                              <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span>
                                         <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span>
                                         <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_reference</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                                   <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
                                   <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span>
                                   <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span>
                                   <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span>
                                  <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span>
                                  <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span>
                                 <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span>
                                 <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:]))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Insert&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">)</span>

        <span class="n">view_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span>
        <span class="k">if</span> <span class="n">view_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">view_range</span> <span class="o">=</span> <span class="mf">5.0</span>

        <span class="c"># We let the depth scale be 25% larger to allow the user to extend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">-=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">view_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">view_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span>
        <span class="k">if</span> <span class="n">view_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">view_range</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">-=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>

        <span class="n">view_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span>
        <span class="k">if</span> <span class="n">view_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">view_range</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">-=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>

        <span class="n">view_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span>
        <span class="k">if</span> <span class="n">view_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">view_range</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">-=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">+=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">view_range</span>

        <span class="c"># msg = &quot;View limits:\n&quot; \</span>
        <span class="c">#       &quot;- depth: %s -&gt; %s\n&quot; \</span>
        <span class="c">#       &quot;- speed: %s -&gt; %s&quot; % (self.p.min_depth, self.p.max_depth, self.p.min_speed, self.p.max_speed)</span>
        <span class="c"># log.info(msg)</span>

    <span class="c"># ####### Plot ######</span>

<div class="viewcode-block" id="SSPManager.on_plot_zoom"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_plot_zoom">[docs]</a>    <span class="k">def</span> <span class="nf">on_plot_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">inspections_mode</span><span class="p">[</span><span class="s">&#39;Zoom&#39;</span><span class="p">]</span>  <span class="c"># zoom mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">clear_user_samples</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Zoom&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;inspection mode: zoom&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_plot_flag"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_plot_flag">[docs]</a>    <span class="k">def</span> <span class="nf">on_plot_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">inspections_mode</span><span class="p">[</span><span class="s">&#39;Flag&#39;</span><span class="p">]</span>  <span class="c"># flag data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">clear_user_samples</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Flag&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;flag interaction: active&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_plot_unflag"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_plot_unflag">[docs]</a>    <span class="k">def</span> <span class="nf">on_plot_unflag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">inspections_mode</span><span class="p">[</span><span class="s">&#39;Unflag&#39;</span><span class="p">]</span>  <span class="c"># unflag data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">clear_user_samples</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Flag&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;unflag interaction: active&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_plot_insert"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_plot_insert">[docs]</a>    <span class="k">def</span> <span class="nf">on_plot_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">inspections_mode</span><span class="p">[</span><span class="s">&#39;Insert&#39;</span><span class="p">]</span>  <span class="c"># insert data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">clear_user_samples</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Insert&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;insert interaction: active&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_on_point_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Insert&quot;</span><span class="p">]:</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;point selection: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">ydata</span>
        <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span> <span class="o">=</span> <span class="n">oceanography</span><span class="o">.</span><span class="n">soundspeed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">,</span>
                                                                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;User manually inserted temperature </span><span class="si">%f</span><span class="s"> and salinity </span><span class="si">%f</span><span class="s"> at depth </span><span class="si">%f</span><span class="s">, calculated sound speed </span><span class="si">%f</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span> <span class="o">=</span> <span class="n">x</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span> <span class="o">=</span> <span class="n">y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;User manually inserted sound speed </span><span class="si">%f</span><span class="s"> at depth </span><span class="si">%f</span><span class="s">&quot;</span> \
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">insert_sample</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_speed</span><span class="p">,</span>
                                            <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">,</span> <span class="n">salinity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">,</span>
                                            <span class="n">source</span><span class="o">=</span><span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;User&#39;</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">clear_user_samples</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span> <span class="o">=</span> <span class="n">y</span>

        <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span> <span class="o">=</span> <span class="n">y</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_area_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Flag&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Zoom&quot;</span><span class="p">]):</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;area selection: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s"> / </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span>
                 <span class="o">%</span> <span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">x1data</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">y1data</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">x2data</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">y2data</span><span class="p">))</span>

        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">x1data</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">y1data</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">x2data</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">y2data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Flag&quot;</span><span class="p">]:</span>
            <span class="c"># Deal with case of user selecting points</span>
            <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">toggle_flag</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="s">&#39;speed&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">toggle_flag</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="s">&#39;temperature&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">toggle_flag</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="s">&#39;salinity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">inspection_mode</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Zoom&quot;</span><span class="p">]:</span>
            <span class="c"># Deal with case of zooming in</span>
            <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="k">elif</span> <span class="n">evt</span><span class="o">.</span><span class="n">axes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span> <span class="o">=</span> <span class="n">x2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span> <span class="o">=</span> <span class="n">y1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span> <span class="o">=</span> <span class="n">y2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">has_zoom_applied</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># In all cases, we update the plots accordingly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the plots&quot;&quot;&quot;</span>
        <span class="c"># log.info(&quot;updating plots&quot;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;CLOSED&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;OPEN&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_view_limits</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot_worker</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">PyDeadObjectError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;dead object&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;index error during plot updating&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;key error during plot updating&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;value error during plot updating&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;attribute error during plot updating&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;runtime error during plot updating&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_plot_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the plots&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="s">&#39;#32cd32&#39;</span>  <span class="c"># green</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="s">&#39;#F23047&#39;</span>  <span class="c"># red</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span>

        <span class="c"># Fresh axes every time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="n">axisbg</span><span class="o">=</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="p">,</span> <span class="n">axisbg</span><span class="o">=</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="p">,</span> <span class="n">axisbg</span><span class="o">=</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_woa</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">:</span>
            <span class="c"># Plot WOA2009 profile for context if desired, but only if we have a current SV loaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="p">:],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:],</span> <span class="s">&#39;m--&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_reference</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="c"># Plot Reference profile</span>
            <span class="n">good_pts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                       <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                      <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                     <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sis_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Plot thinned SSP for sis</span>
            <span class="n">good_pts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sis_data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sis_data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sis_data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                   <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s">&#39;#00FF00&#39;</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s">u&#39;full&#39;</span><span class="p">,</span>
                                   <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#33FF33&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_flagged</span><span class="p">:</span>
            <span class="c"># Plot rejected points if desired</span>
            <span class="n">bad_pts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span> <span class="s">&#39;r,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span> <span class="s">&#39;r,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">bad_pts</span><span class="p">],</span> <span class="s">&#39;r,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Now plot the good points</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;b&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="n">good_pts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">good_pts</span><span class="p">],</span> <span class="n">line</span><span class="p">)</span>

        <span class="c"># Label plots, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Sound Speed [m/s]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth [m]&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Temp [deg C]&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_sal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_sal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">min_depth</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">max_depth</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Sal [psu]&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="n">age_of_transmission</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">time_of_last_tx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;SERVER: </span><span class="si">%d</span><span class="s"> cast(s) delivered</span><span class="se">\n</span><span class="s">Time since last transmission: </span><span class="si">%s</span><span class="s">&quot;</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">delivered_casts</span><span class="p">,</span>
                                          <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">age_of_transmission</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Received </span><span class="si">%s</span><span class="s">... please process and deliver to SIS&quot;</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">time_of_last_tx</span><span class="p">:</span>
                <span class="n">age_of_transmission</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">time_of_last_tx</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">Time since last transmission: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">age_of_transmission</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>

        <span class="c"># plot the current mean depth (if available and the user setting is on)</span>
        <span class="c"># print(&quot;# %s %s&quot; % (self.prj.mean_depth, self.p.display_depth))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_depth</span><span class="p">:</span>
            <span class="c"># draw line on the 3 plots</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;#663300&#39;</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>  <span class="c"># sound speed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>  <span class="c"># temperature</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>  <span class="c"># salinity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

            <span class="c"># draw rectangle on the 3 plots</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mf">0.8</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span><span class="p">),</span> <span class="mi">2100</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                                               <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#996633&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                                               <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#996633&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span><span class="p">),</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                                               <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#996633&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

        <span class="c"># plot vessel draft and surface sound speed (if available) [only on the speed plot]</span>
        <span class="c"># print(&quot;@ %s %s&quot; % (self.prj.vessel_draft, self.prj.surface_sound_speed))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;g--&#39;</span>
            <span class="c"># vertical line</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">12000</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="c"># horizontal line</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mi">2100</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="c"># dot at the draft/surface sound speed intersection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">speed_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">,</span> <span class="s">&#39;g+&#39;</span><span class="p">,</span> <span class="n">mew</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c"># plotting during point insertion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sel_modes</span><span class="p">[</span><span class="s">&quot;Insert&quot;</span><span class="p">]:</span>

            <span class="n">salinities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">temperatures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">depths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">depths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">temperatures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">salinities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">:</span>
                    <span class="n">salinities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">salinities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="s">&quot;c--&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">:</span>
                    <span class="n">temperatures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="s">&quot;c--&quot;</span><span class="p">)</span>

            <span class="n">pts</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;flag&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                   <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">depths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">temperatures</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">salinities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;salinity&#39;</span><span class="p">],</span> <span class="n">pts</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">:</span>
                    <span class="n">salinities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">salinities</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="s">&quot;c--&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">:</span>
                    <span class="n">temperatures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">depths</span><span class="p">,</span> <span class="s">&quot;c--&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">sal_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_salinity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">,</span> <span class="s">&quot;c.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">temp_axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_temperature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">user_depth</span><span class="p">,</span> <span class="s">&quot;c.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c"># ######  Process #####</span>

<div class="viewcode-block" id="SSPManager.on_process_load_salinity"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_load_salinity">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_load_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;XBT-specific function to add salinity values&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;XBT&quot;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;This is a XBT-specific function!&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using reference cast to augment salinity&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
            <span class="n">salinity_source</span> <span class="o">=</span> <span class="s">&#39;user-specified reference file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference_filename</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c"># atlases</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_salinity_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">salinity_sources</span><span class="p">[</span><span class="s">&quot;RTOFS&quot;</span><span class="p">]:</span>
                <span class="c"># ext_type = Dicts.source_types[&#39;RtofsExtend&#39;]</span>
                <span class="n">salinity_source</span> <span class="o">=</span> <span class="s">&quot;RTOFS&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas_loaded</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;RTOFS grids not loaded, reverting to WOA09&quot;</span><span class="p">)</span>
                        <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                        <span class="n">salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">temp_sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="n">temp_sv</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>

                    <span class="k">except</span> <span class="n">SspError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;failure in RTOFS lookup, reverting to WOA09&quot;</span><span class="p">)</span>
                            <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                            <span class="n">salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                            <span class="k">return</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_salinity_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">salinity_sources</span><span class="p">[</span><span class="s">&quot;WOA09&quot;</span><span class="p">]:</span>
                <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                <span class="n">salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in loading WOA09 atlas&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in WOA2009 lookup&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="c"># And then extend by WOA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;unsupported extension source: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_extension_source</span><span class="p">)</span>

        <span class="c"># Now replace the salinity values in the cast with the salinity values in WOA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">calc_speed</span><span class="p">()</span>
        <span class="c"># add metadata to source info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">modify_source_info</span><span class="p">(</span><span class="s">&quot;salinity augmented from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">salinity_source</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Salinity added to profile using source </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">salinity_source</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&#39;Salinity added from </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">salinity_source</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_load_temp_and_sal"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_load_temp_and_sal">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_load_temp_and_sal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;XSV- and SVP- specific function&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;XSV&quot;</span><span class="p">])</span> \
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;SVP&quot;</span><span class="p">]):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;XSV- and SVP-specific function!&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;using reference cast to augment salinity and temperature&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>
            <span class="n">temperature_salinity_source</span> <span class="o">=</span> <span class="s">&#39;user specified reference file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference_filename</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c"># atlases</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_salinity_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">salinity_sources</span><span class="p">[</span><span class="s">&quot;RTOFS&quot;</span><span class="p">]:</span>
                <span class="c"># ext_type = Dicts.source_types[&#39;RtofsExtend&#39;]</span>
                <span class="n">temperature_salinity_source</span> <span class="o">=</span> <span class="s">&quot;RTOFS&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas_loaded</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;RTOFS grids not loaded, reverting to WOA09&quot;</span><span class="p">)</span>
                        <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                        <span class="n">temperature_salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">temp_sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="n">temp_sv</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="n">temp_sv</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>

                    <span class="k">except</span> <span class="n">SspError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;failure in RTOFS lookup, reverting to WOA09&quot;</span><span class="p">)</span>
                            <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                            <span class="n">temperature_salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                            <span class="k">return</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_salinity_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">salinity_sources</span><span class="p">[</span><span class="s">&quot;WOA09&quot;</span><span class="p">]:</span>
                <span class="c"># ext_type = Dicts.source_types[&#39;Woa09Extend&#39;]</span>
                <span class="n">temperature_salinity_source</span> <span class="o">=</span> <span class="s">&quot;WOA09&quot;</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in loading WOA09 atlas&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in WOA2009 lookup&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="c"># And then extend by WOA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;unsupported extension source: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_extension_source</span><span class="p">)</span>

        <span class="c"># add metadata to source info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">modify_source_info</span><span class="p">(</span><span class="s">&quot;temperature/salinity augmented from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">temperature_salinity_source</span><span class="p">)</span>

        <span class="c"># We don&#39;t recalculate speed, of course.  T/S is simply for absorption coefficient calculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Temperature/Salinity added to profile using source </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">temperature_salinity_source</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Temperature/salinity added from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">temperature_salinity_source</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_load_surface_ssp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_load_surface_ssp">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_load_surface_ssp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="p">:</span>
            <span class="n">surface_ssp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">sound_speed</span><span class="p">)</span>
            <span class="n">surface_ssp_source</span> <span class="o">=</span> <span class="s">&quot;depth datagram&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span>
                                     <span class="s">&#39;No surface sound speed received on port 16103.</span><span class="se">\n</span><span class="s">Please enter surface sound speed&#39;</span><span class="p">,</span>
                                     <span class="s">&#39;Text Entry&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">surface_ssp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">surface_ssp_source</span> <span class="o">=</span> <span class="s">&quot;manual entry&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_transducer_draft</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Insert the surface speed value into the profile at the vessel_draft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mf">1.15</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">insert_sample</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="n">surface_ssp</span><span class="p">,</span>
                                        <span class="n">temperature</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">salinity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                        <span class="n">source</span><span class="o">=</span><span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;SurfaceSensor&#39;</span><span class="p">])</span>

        <span class="c"># And set all values shoaller than the draft to be the same speed</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_ssp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">modify_source_info</span><span class="p">(</span><span class="s">&#39;surface sound speed from </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">surface_ssp_source</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Surface sound speed </span><span class="si">%.2f</span><span class="s"> added to profile for upper </span><span class="si">%.1f</span><span class="s"> m (source: </span><span class="si">%s</span><span class="s">)&#39;</span> \
              <span class="o">%</span> <span class="p">(</span><span class="n">surface_ssp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">,</span> <span class="n">surface_ssp_source</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Added surface sound speed </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">surface_ssp</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_extend"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_extend">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;no ssp to extend&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Extending with user-specified reference profile&quot;</span><span class="p">)</span>
            <span class="n">ext_type</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;UserRefExtend&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">,</span> <span class="n">ext_type</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c"># atlases</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_extension_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">extension_sources</span><span class="p">[</span><span class="s">&quot;RTOFS&quot;</span><span class="p">]:</span>
                <span class="n">ext_type</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;RtofsExtend&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas_loaded</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;RTOFS grids not loaded, reverting to WOA09&quot;</span><span class="p">)</span>
                        <span class="n">ext_type</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;Woa09Extend&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="n">ext_type</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">temp_sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">rtofs_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_sv</span><span class="p">,</span> <span class="n">ext_type</span><span class="p">)</span>
                        <span class="c"># now use the WOA09 since it usually goes deeper</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp_sv</span><span class="p">,</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;Woa09Extend&#39;</span><span class="p">])</span>

                    <span class="k">except</span> <span class="n">SspError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>  <span class="c"># try with WOA09</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;failure in RTOFS lookup, reverting to WOA09&quot;</span><span class="p">)</span>
                            <span class="n">ext_type</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;Woa09Extend&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="n">ext_type</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: Failed on load RTOFS and WOA09 grids&quot;</span>
                            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                            <span class="k">return</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_extension_source</span> <span class="o">==</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">extension_sources</span><span class="p">[</span><span class="s">&quot;WOA09&quot;</span><span class="p">]:</span>
                <span class="n">ext_type</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">source_types</span><span class="p">[</span><span class="s">&#39;Woa09Extend&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas_loaded</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in loading WOA09 atlas&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Functionality disabled: failure in WOA2009 lookup&quot;</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span>

                <span class="c"># And then extend by WOA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="n">ext_type</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;unsupported extension source: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">ssp_extension_source</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Profile extended to depth </span><span class="si">%d</span><span class="s"> m using source type </span><span class="si">%s</span><span class="s">&#39;</span> \
              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ext_type</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">modify_source_info</span><span class="p">(</span><span class="s">&quot;extension type </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ext_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&#39;Profile extended using source type </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ext_type</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_preview_thinning"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_preview_thinning">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_preview_thinning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;preview thinning&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">prepare_sis_data</span><span class="p">(</span><span class="n">thin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Preview the thinning step required by some client types&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&#39;Preview thinning&#39;</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_send_profile"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_send_profile">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_send_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">auto_export_on_send</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">count_export_formats</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;The selected &#39;auto-export&#39; option requires selection of export formats from Export sub-menu.</span><span class="se">\n</span><span class="s">&quot;</span> \
                  <span class="s">&quot;Send anyway or cancel?&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Auto-export option&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_recipient_ip</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Enter Remote IP address&#39;</span><span class="p">,</span> <span class="s">&#39;Text Entry&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c"># inet_pton supports IPV6</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Error: Invalid IP address&quot;</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_recipient_ip</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">pause_corrections</span><span class="p">()</span>

            <span class="n">corrector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">get_corrector</span><span class="p">()</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">get_mean_depth</span><span class="p">()</span>

            <span class="c"># Only if the server is not running</span>
            <span class="k">if</span> <span class="n">corrector</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Do you really want to apply the corrector calculated with the Refraction Monitor?</span><span class="se">\n</span><span class="s">&quot;</span> \
                      <span class="s">&quot;This will manipulate the SSP (corrector: </span><span class="si">%.1f</span><span class="s">, depth: </span><span class="si">%.1f</span><span class="s">)&quot;</span> \
                      <span class="o">%</span> <span class="p">(</span><span class="n">corrector</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Warning&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                    <span class="n">corrector</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">corrector</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;applying corrector: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">corrector</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">corrector</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">Dicts</span><span class="o">.</span><span class="n">idx</span><span class="p">[</span><span class="s">&#39;speed&#39;</span><span class="p">],</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">corrector</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_corrector</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># loop through client list</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">num_clients</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">sis_auto_apply_manual_casts</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">kng_formats</span><span class="p">[</span><span class="s">&#39;S01&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">kng_formats</span><span class="p">[</span><span class="s">&#39;S12&#39;</span><span class="p">]</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Transmitting cast to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">()</span>

            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">send_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">sis_auto_apply_manual_casts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="s">&quot;SIS&quot;</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Reception confirmed from &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Reception confirmed!&quot;</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;SIS confirmed the SSP reception!&quot;</span>
                        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;SIS acknowledge&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Transmitted cast, confirm reception in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">protocol</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Cannot confirm reception of profile for client </span><span class="si">%s</span><span class="s">, please check SIS:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;1) Check sound speed file name in SIS run-time parameters &quot;</span> \
                           <span class="s">&quot;and match date/time in SIS .asvp filename with cast date/time to ensure receipt</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;2) Ensure SVP datagram is being distributed to this IP &quot;</span> \
                           <span class="s">&quot;on port </span><span class="si">%d</span><span class="s"> to enable future confirmations&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">km_listen_port</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Acknowledge&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">sis_auto_apply_manual_casts</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Profile transmitted, SIS is waiting for operator confirmation.&quot;</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Acknowledge&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Transmitted Data: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">convert_km</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># Now that we&#39;re done sending to clients, auto-export files if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">auto_export_on_send</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">formats_export</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">time_of_last_tx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">time_of_last_tx</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">resume_corrections</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">:</span>
            <span class="c"># If we had received a sippican cast over UDP</span>
            <span class="c"># then update the display to remove the RED background</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_store_db"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_store_db">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_store_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;store current SSP:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>

        <span class="c"># create a collection with only the current cast</span>
        <span class="n">ssp_coll</span> <span class="o">=</span> <span class="n">SspCollection</span><span class="p">()</span>
        <span class="n">ssp_coll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>

        <span class="c"># add the created collection to the local db</span>
        <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
        <span class="n">ssp_db</span><span class="o">.</span><span class="n">add_casts</span><span class="p">(</span><span class="n">ssp_coll</span><span class="p">)</span>
        <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_redo_processing"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_redo_processing">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_redo_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Do you really want to reload the stored raw data?</span><span class="se">\n</span><span class="s">&quot;</span> \
              <span class="s">&quot;This implies to lose all the applied processing actions!&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Restart processing&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_NO</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;restart processing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">restart_processing</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Restart processing using stored raw data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&#39;Restart processing&#39;</span>
</div>
<div class="viewcode-block" id="SSPManager.on_process_log_metadata"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_process_log_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">on_process_log_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activate the logging of the processing metadata&quot;&quot;&quot;</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessLogMetadata</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="c"># to be able to log the first and the last message</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">activate_logging_on_db</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">deactivate_logging_on_db</span><span class="p">()</span>

    <span class="c"># def on_process_express_mode(self, evt):</span>
    <span class="c"># &quot;&quot;&quot;DISABLED SINCE USERS TEND TO MISUSE THIS FUNCTIONALITY&quot;&quot;&quot;</span>
    <span class="c">#     msg = &quot;Are you sure you want to do express processing?\nThis will deliver the profile to the sounder.&quot;</span>
    <span class="c">#     dlg = wx.MessageDialog(None, msg, &quot;Question&quot;, wx.OK | wx.CANCEL | wx.ICON_QUESTION)</span>
    <span class="c">#     result = dlg.ShowModal()</span>
    <span class="c">#     dlg.Destroy()</span>
    <span class="c">#     if result == wx.ID_CANCEL:</span>
    <span class="c">#         return</span>
    <span class="c">#     if self.prj.ssp_data.sensor_type == Dict.sensor_types[&quot;XBT&quot;]:</span>
    <span class="c">#         self.on_process_load_salinity(evt)</span>
    <span class="c">#     elif self.prj.ssp_data.sensor_type == &quot;XSV&quot; or self.prj.ssp_data.sensor_type == &quot;SVP&quot;:</span>
    <span class="c">#         self.on_process_load_temp_and_sal(evt)</span>
    <span class="c">#     self.on_process_load_surface_ssp(evt)</span>
    <span class="c">#     self.on_process_extend(evt)</span>
    <span class="c">#     self.on_process_send_profile(evt)</span>

    <span class="c"># ####### Database ######</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_query_internal_db"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_query_internal_db">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_query_internal_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;query internal db&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_query_db</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_query_external_db"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_query_external_db">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_query_external_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;query external db&quot;</span><span class="p">)</span>

        <span class="c"># retrieve the name of the format</span>
        <span class="n">selection_filter</span> <span class="o">=</span> <span class="s">&quot;DB files (*.db,*.DB)|*.db;*.DB|All File (*.*)|*.*&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;External DB Selection&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">selection_filter</span><span class="p">,</span>
                            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_CHANGE_DIR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">db_directory</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
        <span class="n">db_file</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_directory</span><span class="p">,</span> <span class="n">db_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_query_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_query_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Query and load SSP from a DB (both internal and extenal)&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">db_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">HyOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">pk_list</span> <span class="o">=</span> <span class="n">ssp_db</span><span class="o">.</span><span class="n">list_all_ssp_pks</span><span class="p">()</span>
        <span class="c"># print(pk_list)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;The DB is empty. Load and store an SSP first!&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_WARNING</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="n">dlg_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;</span><span class="si">%04d</span><span class="s">: </span><span class="si">%s</span><span class="s"> @ </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">first_match</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">4</span><span class="p">]))))</span>
                    <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">pk_list</span><span class="p">]</span>
        <span class="c"># print(dlg_list)</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SingleChoiceDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Pick a stored SSP&quot;</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">dlg_list</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c"># actually loading the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span> <span class="o">=</span> <span class="n">ssp_db</span><span class="o">.</span><span class="n">get_ssp_by_pk</span><span class="p">(</span><span class="n">pk_list</span><span class="p">[</span><span class="n">dialog</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()][</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_LocalDB&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">original_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;salinity&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">replace_samples</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="s">&#39;temperature&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Loaded SSP from local DB&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Loaded selected SSP: </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">(),</span> <span class="n">dialog</span><span class="o">.</span><span class="n">GetStringSelection</span><span class="p">()))</span>

        <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="c"># Delete</span>

<div class="viewcode-block" id="SSPManager.on_db_delete_internal"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_delete_internal">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_delete_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;deletion from internal db&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_db_ssp</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_delete_external"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_delete_external">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_delete_external</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;deletion from external db&quot;</span><span class="p">)</span>

        <span class="c"># retrieve the name of the format</span>
        <span class="n">selection_filter</span> <span class="o">=</span> <span class="s">&quot;DB files (*.db,*.DB)|*.db;*.DB|All File (*.*)|*.*&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;External DB Selection&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">selection_filter</span><span class="p">,</span>
                            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_CHANGE_DIR</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">db_directory</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
        <span class="n">db_file</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_directory</span><span class="p">,</span> <span class="n">db_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_query_db</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_delete_db_ssp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete SSP entries from a DB (both internal and extenal)&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">db_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="n">db_path</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">HyOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">pk_list</span> <span class="o">=</span> <span class="n">ssp_db</span><span class="o">.</span><span class="n">list_all_ssp_pks</span><span class="p">()</span>
        <span class="c"># print(pk_list)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pk_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;The DB is empty. Nothing to delete!&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_WARNING</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="n">dlg_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;</span><span class="si">%04d</span><span class="s">: </span><span class="si">%s</span><span class="s"> @ </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">first_match</span><span class="p">(</span><span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">4</span><span class="p">]))))</span>
                    <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">pk_list</span><span class="p">]</span>
        <span class="c"># print(dlg_list)</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SingleChoiceDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Pick a stored SSP&quot;</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">dlg_list</span><span class="p">)</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">selection</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c"># actually do the deletion</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">delete_ssp_by_pk</span><span class="p">(</span><span class="n">pk_list</span><span class="p">[</span><span class="n">dialog</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()][</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">except</span> <span class="n">HyOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

    <span class="c"># Export</span>

<div class="viewcode-block" id="SSPManager.on_db_export_shp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_export_shp">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_export_shp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;exporting as shapefile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_export</span><span class="p">(</span><span class="n">GdalAux</span><span class="o">.</span><span class="n">ogr_formats</span><span class="p">[</span><span class="n">b</span><span class="s">&#39;ESRI Shapefile&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_export_kml"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_export_kml">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_export_kml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;exporting as kml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_export</span><span class="p">(</span><span class="n">GdalAux</span><span class="o">.</span><span class="n">ogr_formats</span><span class="p">[</span><span class="n">b</span><span class="s">&#39;KML&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_export_csv"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_export_csv">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;exporting as csv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_export</span><span class="p">(</span><span class="n">GdalAux</span><span class="o">.</span><span class="n">ogr_formats</span><span class="p">[</span><span class="n">b</span><span class="s">&#39;CSV&#39;</span><span class="p">])</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_db_export</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ogr_format</span><span class="p">):</span>
        <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ssp_db</span><span class="o">.</span><span class="n">convert_ssp_view_to_ogr</span><span class="p">(</span><span class="n">ogr_format</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">HyOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Local DB&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">Helper</span><span class="o">.</span><span class="n">explore_folder</span><span class="p">(</span><span class="n">ssp_db</span><span class="o">.</span><span class="n">export_folder</span><span class="p">)</span>

    <span class="c"># Plot</span>

<div class="viewcode-block" id="SSPManager.on_db_plot_map_ssp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_plot_map_ssp">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_plot_map_ssp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;plot a map with all SSPs&quot;</span><span class="p">)</span>
        <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
        <span class="n">ssp_db</span><span class="o">.</span><span class="n">map_ssp_view</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_plot_daily_ssp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_plot_daily_ssp">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_plot_daily_ssp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;plot daily SSPs&quot;</span><span class="p">)</span>
        <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
        <span class="n">ssp_db</span><span class="o">.</span><span class="n">create_daily_plots</span><span class="p">(</span><span class="n">save_fig</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_db_save_daily_ssp"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_db_save_daily_ssp">[docs]</a>    <span class="k">def</span> <span class="nf">on_db_save_daily_ssp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;save daily SSPs&quot;</span><span class="p">)</span>
        <span class="n">ssp_db</span> <span class="o">=</span> <span class="n">SspDb</span><span class="p">()</span>
        <span class="n">ssp_db</span><span class="o">.</span><span class="n">create_daily_plots</span><span class="p">(</span><span class="n">save_fig</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">Helper</span><span class="o">.</span><span class="n">explore_folder</span><span class="p">(</span><span class="n">ssp_db</span><span class="o">.</span><span class="n">plots_folder</span><span class="p">)</span>

    <span class="c"># ####### Tools ######</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_geo_monitor"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_geo_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_geo_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display a map with the profile position&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;geo monitor not available&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Request the current SVP cast from the clients prior. Take the first one that comes through.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">num_clients</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Testing client </span><span class="si">%s</span><span class="s"> for position ...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_recipient_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">get_cast_from_sis</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;... got SSP &gt; valid client&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;... not valid SSP &gt; skip this client&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Unable to run the geo-monitor since no casts were retrieved from SIS clients&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Clients issue&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geo_monitor</span><span class="o">.</span><span class="n">OnShow</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_refraction_monitor"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_refraction_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_refraction_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display a refraction monitor&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;refraction monitor not available&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># Request the current SVP cast from the clients prior. Take the first one that comes through.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">num_clients</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Testing client </span><span class="si">%s</span><span class="s"> for position ...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_recipient_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">client_list</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client</span><span class="p">]</span><span class="o">.</span><span class="n">IP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">get_cast_from_sis</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;... got SSP &gt; valid client&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;... not valid SSP &gt; skip this client&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Unable to run the ref-monitor since no casts were retrieved from SIS clients&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Clients issue&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;got SIS ssp (samples </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">num_entries</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;CLOSED&#39;</span><span class="p">]:</span>
            <span class="c"># Maybe when running in this state, the requested SVP is</span>
            <span class="c"># loaded into the SVP Editor?  This is behavior is inconsistent</span>
            <span class="c"># with other modes (OPEN, SERVER) where the profile is already loaded.</span>
            <span class="c"># Perhaps should force user to open a profile from SIS?</span>
            <span class="c"># Could then limit ability to launch refraction monitor from the</span>
            <span class="c"># OPEN and SERVER states and have it disabled in the CLOSED state.</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;we are CLOSED!&quot;</span><span class="p">)</span>
            <span class="n">ssp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">convert_ssp</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="n">ssp</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;SERVER&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">OnShow</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_user_inputs"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_user_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_user_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs_viewer</span><span class="o">.</span><span class="n">OnShow</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_modify_settings"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_modify_settings">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_modify_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_tool</span> <span class="o">=</span> <span class="n">ssp_settings</span><span class="o">.</span><span class="n">SSPSettings</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_tool</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_view_settings"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings_viewer</span><span class="o">.</span><span class="n">OnShow</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_reload_settings"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_reload_settings">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_reload_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">load_settings_from_db</span><span class="p">()</span>

    <span class="c"># ### SERVER ###</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_server_start"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_server_start">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_server_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;start the server mode&quot;&quot;&quot;</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="s">&quot;Do you really want to start the Server Mode?</span><span class="se">\n\n</span><span class="s">&quot;</span>
                               <span class="s">&quot;The Server Mode creates SSPs based on oceanographic models for SIS.</span><span class="se">\n</span><span class="s">&quot;</span>
                               <span class="s">&quot;Thus, it is meant for use in transit, NOT for systematic seabed mapping.</span><span class="se">\n</span><span class="s">&quot;</span>
                               <span class="s">&quot;This Mode will OVERWRITE the current SIS SSP.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                               <span class="s">&quot;Server Mode&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># - check and ask for draft</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_transducer_draft</span><span class="p">()</span>

            <span class="c"># if still not available, return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># store since it can change with updates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_vessel_draft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Starting server&quot;</span><span class="p">)</span>

        <span class="c"># - start the server</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">check_settings</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;SERVER&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">display_woa</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Unable to start the Server Mode&quot;</span><span class="p">,</span> <span class="s">&quot;Server Mode&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">set_refraction_monitor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">)</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c"># Now set up a timer for cast plot updates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server_timer</span> <span class="o">=</span> <span class="n">TimerThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor_server</span><span class="p">,</span> <span class="n">timing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_server_send"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_server_send">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_server_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;forcing server to send profile NOW!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">force_send</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="SSPManager.monitor_server"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.monitor_server">[docs]</a>    <span class="k">def</span> <span class="nf">monitor_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stopped_on_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">by_thread</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_sippican_to_process</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_mvp_to_process</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Server stopped with message: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">error_message</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Acknowledge&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">update_plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">update_plot</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_server_stop"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_server_stop">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_server_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Do you really want to stop the server?&quot;</span><span class="p">,</span> <span class="s">&quot;Confirm Server Stop&quot;</span><span class="p">,</span>
                               <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;User instructed to stop the Server Mode&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_server_log_metadata"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_server_log_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_server_log_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activate the logging of the server metadata&quot;&quot;&quot;</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ServerLogMetadata</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">activate_server_logging_on_db</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">deactivate_server_logging_on_db</span><span class="p">()</span>

    <span class="c"># ### REF CAST ###</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_set_reference_cast"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_set_reference_cast">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_set_reference_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set a reference cast&quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;set as reference cast:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_edit_reference_cast"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_edit_reference_cast">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_edit_reference_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Must close currently loaded profile to edit the reference profile.  Proceed?&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Question&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>  <span class="c"># Show it</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">clean_project</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_app</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">filename_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_woa_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">woa09_atlas</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">date_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">has_ssp_loaded</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_speed_applied</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_applied_depth</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&#39;OPEN&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="s">&quot;Loaded </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">filename</span>
</div>
<div class="viewcode-block" id="SSPManager.on_tools_clear_reference_cast"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_tools_clear_reference_cast">[docs]</a>    <span class="k">def</span> <span class="nf">on_tools_clear_reference_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_reference_filename</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_plot</span><span class="p">()</span>

    <span class="c"># ####### HELP ######</span>
</div>
<div class="viewcode-block" id="SSPManager.on_help_manual"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_help_manual">[docs]</a>    <span class="k">def</span> <span class="nf">on_help_manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Open manual &quot;&quot;&quot;</span>
        <span class="c"># manual_path = os.path.abspath(os.path.join(self.here, os.path.pardir, &quot;docs&quot;, &quot;manual.pdf&quot;))</span>
        <span class="c"># if not os.path.isfile(manual_path):</span>
        <span class="c">#     log.warning(&quot;missing manual at: %s&quot; % manual_path)</span>
        <span class="c">#     return</span>
        <span class="c"># log.info(&quot;open manual: %s&quot; % manual_path)</span>
        <span class="c"># Helper.explore_folder(manual_path)</span>

        <span class="c"># Open the url with the online documentation for SSP Manager</span>
        <span class="kn">import</span> <span class="nn">webbrowser</span>
        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;http://giumas.github.io/hyo_ssp_manager/latest/index.html&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SSPManager.on_help_about"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.on_help_about">[docs]</a>    <span class="k">def</span> <span class="nf">on_help_about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Info about the application&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">platform</span>
        <span class="kn">from</span> <span class="nn">hydroffice</span> <span class="kn">import</span> <span class="n">base</span>
        <span class="kn">from</span> <span class="nn">hydroffice</span> <span class="kn">import</span> <span class="n">ssp</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y&quot;</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">AboutDialogInfo</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="s">&quot;SSP Manager&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetLicense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">license</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetIcon</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">here</span><span class="p">,</span> <span class="s">&quot;media&quot;</span><span class="p">,</span> <span class="s">&quot;ccom.png&quot;</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_PNG</span><span class="p">))</span>
        <span class="n">about_description</span> <span class="o">=</span> <span class="s">&quot;SSP Manager processes XBT/SVP/CTD data for being used by </span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;acoustic systems.</span><span class="se">\n\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;This work is/has been funded by:</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - NOAA grant NA10NOS4000073</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - NSF grant 1150574</span><span class="se">\n\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;For bugs and unsupported formats, please send an email </span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;(with attached the data files to reproduce and troubleshoot </span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;the issue!) to:</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - hydroffice.ssp_manager@ccom.unh.edu</span><span class="se">\n\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;For code contributions and general comments, write to:</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - gmasetti@ccom.unh.edu</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - brc@ccom.unh.edu</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - matthew.wilson@noaa.gov</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;Contributors:</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - glen.rice@noaa.gov</span><span class="se">\n\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot;Environment:</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - os: </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">bit]</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - python: </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">bit]</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - wxPython: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - matplotlib: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - hydroffice.base: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> \
                            <span class="s">&quot; - hydroffice.ssp: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                            <span class="p">(</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;64&quot;</span> <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">is_64bit_os</span><span class="p">()</span> <span class="k">else</span> <span class="s">&quot;32&quot;</span><span class="p">,</span>
                                <span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">(),</span> <span class="s">&quot;64&quot;</span> <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">is_64bit_python</span><span class="p">()</span> <span class="k">else</span> <span class="s">&quot;32&quot;</span><span class="p">,</span>
                                <span class="n">wx</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                                <span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                                <span class="n">base</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                                <span class="n">ssp</span><span class="o">.</span><span class="n">__version__</span>
                            <span class="p">)</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">SetDescription</span><span class="p">(</span><span class="n">about_description</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetCopyright</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> (C) UNH/CCOM&quot;</span> <span class="o">%</span> <span class="n">current_year</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">AboutBox</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

    <span class="c">################################################</span>
    <span class="c">###               USER DIALOGS               ###</span>
</div>
<div class="viewcode-block" id="SSPManager.get_transducer_draft"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.get_transducer_draft">[docs]</a>    <span class="k">def</span> <span class="nf">get_transducer_draft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask user for transducer draft&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">transducer_draft</span>
            <span class="k">return</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;Enter the transducer draft&#39;</span><span class="p">,</span> <span class="s">&#39;Transducer draft&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">dlg_value</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlg_value</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Invalid draft entry: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">dlg_value</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Invalid value&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_ERROR</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
</div>
<div class="viewcode-block" id="SSPManager.get_position"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.get_position">[docs]</a>    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask user for position, if not available&quot;&quot;&quot;</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Geographic location required for pressure/depth conversion and atlas lookup.</span><span class="se">\n</span><span class="s">&quot;</span> \
                  <span class="s">&quot;Use geographic position from SIS?</span><span class="se">\n</span><span class="s">Choose &#39;no&#39; to enter position manually.&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Question&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">latitude</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">longitude</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;User set cast position </span><span class="si">%lf</span><span class="s"> </span><span class="si">%lf</span><span class="s"> from SIS input&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_NO</span><span class="p">:</span>
                <span class="n">latitude</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">longitude</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">latitude</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">longitude</span><span class="p">:</span>
            <span class="c"># latitude</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Geographic location required for pressure/depth conversion and atlas &quot;</span>
                                               <span class="s">&quot;lookup.Enter latitude as signed decimal degrees (-10.123).&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;Latitude&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">latitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">break</span>

                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>

            <span class="c"># longitude</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Geographic location required for pressure/depth conversion and atlas &quot;</span>
                                               <span class="s">&quot;lookup. Enter longitude as signed decimal degrees (-50.123).&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;Longitude&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">longitude</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        <span class="k">break</span>

                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">pass</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Manual user input position: </span><span class="si">%lf</span><span class="s"> </span><span class="si">%lf</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SSPManager.get_date"><a class="viewcode-back" href="../../../api/hydroffice.ssp_manager.html#hydroffice.ssp_manager.sspmanager.SSPManager.get_date">[docs]</a>    <span class="k">def</span> <span class="nf">get_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask user for date, if not available&quot;&quot;&quot;</span>

        <span class="c"># SIS specific</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Date required for database lookup.</span><span class="se">\n</span><span class="s">Use date from SIS?</span><span class="se">\n</span><span class="s">Choose &#39;no&#39; to enter date manually.&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Question&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">dg_time</span>
                <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Cast date </span><span class="si">%s</span><span class="s"> from SIS input&#39;</span> <span class="o">%</span> <span class="n">date</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">date</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Invalid date in SIS datagram&#39;</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># date from the machine clock</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Date required for database lookup.</span><span class="se">\n</span><span class="s">Use UTC date from this machine?</span><span class="se">\n</span><span class="s">Choose &#39;no&#39; to enter date manually.&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&quot;Question&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;User set cast date </span><span class="si">%s</span><span class="s"> from computer clock&#39;</span> <span class="o">%</span> <span class="n">date</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">date</span>

        <span class="c"># user input date / time</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Date required for database lookup.</span><span class="se">\n</span><span class="s">Please enter date (YYYY-MM-DD).&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&#39;Date&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">date_string</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Date required for database lookup.</span><span class="se">\n</span><span class="s">Please enter time (HH:MM:SS).&quot;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&#39;Enter Date&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cast_time</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]),</span>
                                       <span class="nb">int</span><span class="p">(</span><span class="n">cast_time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cast_time</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cast_time</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;User input cast date </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">date</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">date</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="c"># ###############################################</span>
    <span class="c"># ###                  DEBUGGING              ###</span>
</div>
    <span class="k">def</span> <span class="nf">_update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">MENUS_ALL</span><span class="p">:</span>  <span class="c"># Enable ALL the menu items</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GetMenuBar</span><span class="p">()</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># selectively disable some based on the state</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;CLOSED&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">MENUS_DISABLED_ON_CLOSED</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetMenuBar</span><span class="p">()</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;OPEN&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">MENUS_DISABLED_ON_OPEN</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetMenuBar</span><span class="p">()</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;XBT&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ProcessLoadSal</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;XSV&quot;</span><span class="p">]</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="o">.</span><span class="n">sensor_type</span> <span class="o">!=</span> <span class="n">Dicts</span><span class="o">.</span><span class="n">sensor_types</span><span class="p">[</span><span class="s">&quot;SVP&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ProcessLoadTempSal</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">ssp_data</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui_state</span><span class="p">[</span><span class="s">&quot;SERVER&quot;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sspmanager_ui</span><span class="o">.</span><span class="n">MENUS_DISABLED_ON_SERVER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetMenuBar</span><span class="p">()</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_monitor</span><span class="o">.</span><span class="n">set_ssp</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SspError</span><span class="p">(</span><span class="s">&quot;Passed wrong state type: </span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">state</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">_update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provide info from SIS to the user through status bar&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_statusbar</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_message</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># in case that the SIS listener is absent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_statusbar</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&quot;Disabled SIS listener&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">sis_info_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># time stamp</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">dg_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sis_info_str</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">dg_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">sis_info_str</span> <span class="o">=</span> <span class="s">&quot;NA, &quot;</span>

            <span class="c"># position</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">latitude</span>
                <span class="k">if</span> <span class="n">latitude</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="s">&quot;S&quot;</span>
                <span class="n">lat_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">latitude</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">latitude</span><span class="p">)))</span>
                <span class="n">lat_str</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%02d</span><span class="se">\N{DEGREE SIGN}</span><span class="si">%7.3f</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">latitude</span><span class="p">)),</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">letter</span><span class="p">)</span>

                <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">longitude</span>
                <span class="k">if</span> <span class="n">longitude</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="s">&quot;W&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="s">&quot;E&quot;</span>
                <span class="n">lon_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">longitude</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">longitude</span><span class="p">)))</span>
                <span class="n">lon_str</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%03d</span><span class="se">\N{DEGREE SIGN}</span><span class="si">%7.3f</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">longitude</span><span class="p">)),</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">letter</span><span class="p">)</span>

                <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">), &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat_str</span><span class="p">,</span> <span class="n">lon_str</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&quot;(NA, NA), &quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">sound_speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s"> m/s, &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">sound_speed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">sound_speed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">transducer_draft</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&#39;NA m/s, &#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">number_beams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">transducer_draft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">detection_information</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">mean_depth</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">depth_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">number_beams</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">detection_information</span><span class="p">[</span><span class="n">beam</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c"># We skip beams without valid detections</span>
                        <span class="k">continue</span>
                    <span class="n">mean_depth</span> <span class="o">=</span> <span class="n">mean_depth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">depth</span><span class="p">[</span><span class="n">beam</span><span class="p">]</span>
                    <span class="n">depth_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">depth_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">mean_depth</span> <span class="o">=</span> <span class="n">mean_depth</span> <span class="o">/</span> <span class="n">depth_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">km_listener</span><span class="o">.</span><span class="n">xyz88</span><span class="o">.</span><span class="n">transducer_draft</span>
                    <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s"> m&#39;</span> <span class="o">%</span> <span class="n">mean_depth</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span> <span class="o">=</span> <span class="n">mean_depth</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&#39;NA m&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sis_info_str</span> <span class="o">+=</span> <span class="s">&#39;XYZ88 NA [Pinging?]&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">mean_depth</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">surface_sound_speed</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj</span><span class="o">.</span><span class="n">vessel_draft</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_statusbar</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="n">sis_info_str</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../../../index.html">
  <img class="logo" src="https://bitbucket.org/ccomjhc/hyo_ssp_manager/raw/tip/hydroffice/ssp_manager/media/favicon.png" alt="Logo"/>
</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydrOffice SSP Manager 2.1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../ssp_manager.html" >hydroffice.ssp_manager</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, University of New Hampshire, Center for Coastal and Ocean Mapping.
    </div>
  </body>
</html>